pkgname=linux-base
pkgver=1.2
pkgrel=6
pkgdesc='Fedora Linux base for binary compaitability.'
url='http://www.fedoraproject.org/'
license=('GPL')
arch=('any')
install=linuxbase.install
makedepends=(rpmextract)
options=(!strip)
noextract=(basesystem-10.0-1.noarch.rpm
	bash-3.2-30.fc10.i386.rpm
	bzip2-1.0.5-3.fc10.i386.rpm
	bzip2-libs-1.0.5-3.fc10.i386.rpm
	compat-db-4.6.21-5.fc10.i386.rpm
	compat-libstdc++-296-2.96-141.i386.rpm
	compat-libstdc++-33-3.2.3-64.i386.rpm
	coreutils-6.12-20.fc10.i386.rpm
	db4-4.7.25-7.fc10.i386.rpm
	e2fsprogs-1.41.4-6.fc10.i386.rpm
	e2fsprogs-libs-1.41.4-6.fc10.i386.rpm
	elfutils-0.142-1.fc10.i386.rpm
	fedora-release-10-1.noarch.rpm
	filesystem-2.4.19-1.fc10.i386.rpm
	freetype-2.3.7-3.fc10.i386.rpm
	gamin-0.1.9-6.fc10.i386.rpm
	gdbm-1.8.0-29.fc10.i386.rpm
	glib-1.2.10-32.fc10.i386.rpm
	glib2-2.18.4-2.fc10.i386.rpm
	glibc-2.9-3.i386.rpm
	glibc-common-2.9-3.i386.rpm
	grep-2.5.1a-61.fc10.i386.rpm
	info-4.12-4.fc10.i386.rpm
	keyutils-libs-1.2-3.fc9.i386.rpm
	krb5-libs-1.6.3-18.fc10.i386.rpm
	libacl-2.2.47-3.fc10.i386.rpm
	libattr-2.4.43-2.fc10.i386.rpm
	libcap-2.10-2.fc10.i386.rpm
	libgcc-4.3.2-7.i386.rpm
	libidn-0.6.14-8.i386.rpm
	libselinux-2.0.78-1.fc10.i386.rpm
	libsepol-2.0.33-1.fc10.i386.rpm
	libstdc++-4.3.2-7.i386.rpm
	ncurses-5.6-20.20080927.fc10.i386.rpm
	ncurses-libs-5.6-20.20080927.fc10.i386.rpm
	pcre-7.8-1.fc10.i386.rpm
	popt-1.13-4.fc10.i386.rpm
	readline-5.2-13.fc9.i386.rpm
	setserial-2.17-22.fc9.i386.rpm
	setup-2.7.4-4.fc10.noarch.rpm
	slang-2.1.4-1.fc10.i386.rpm
	zlib-1.2.3-18.fc9.i386.rpm)
source=('http://critical.ch/distfiles/rpm/i386/fedora/10/basesystem-10.0-1.noarch.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/bash-3.2-30.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/bzip2-1.0.5-3.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/bzip2-libs-1.0.5-3.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/compat-db-4.6.21-5.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/compat-libstdc++-296-2.96-141.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/compat-libstdc++-33-3.2.3-64.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/coreutils-6.12-20.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/db4-4.7.25-7.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/e2fsprogs-1.41.4-6.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/e2fsprogs-libs-1.41.4-6.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/elfutils-0.142-1.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/fedora-release-10-1.noarch.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/filesystem-2.4.19-1.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/freetype-2.3.7-3.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/gamin-0.1.9-6.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/gdbm-1.8.0-29.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/glib-1.2.10-32.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/glib2-2.18.4-2.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/glibc-2.9-3.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/glibc-common-2.9-3.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/grep-2.5.1a-61.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/info-4.12-4.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/keyutils-libs-1.2-3.fc9.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/krb5-libs-1.6.3-18.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libacl-2.2.47-3.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libattr-2.4.43-2.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libcap-2.10-2.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libgcc-4.3.2-7.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libidn-0.6.14-8.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libselinux-2.0.78-1.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libsepol-2.0.33-1.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/libstdc++-4.3.2-7.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/ncurses-5.6-20.20080927.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/ncurses-libs-5.6-20.20080927.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/pcre-7.8-1.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/popt-1.13-4.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/readline-5.2-13.fc9.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/setserial-2.17-22.fc9.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/setup-2.7.4-4.fc10.noarch.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/slang-2.1.4-1.fc10.i386.rpm'
	'http://critical.ch/distfiles/rpm/i386/fedora/10/zlib-1.2.3-18.fc9.i386.rpm'
	'http://archive.fedoraproject.org/pub/archive/fedora/linux/updates/10/i386/elfutils-libelf-0.142-1.fc10.i386.rpm'
	'http://archive.fedoraproject.org/pub/archive/fedora/linux/updates/10/i386/elfutils-libs-0.142-1.fc10.i386.rpm'
	'http://archive.fedoraproject.org/pub/archive/fedora/linux/updates/10/i386/pam-1.0.4-4.fc10.i386.rpm'
	'http://archive.fedoraproject.org/pub/archive/fedora/linux/updates/10/i386/audit-libs-1.7.13-1.fc10.i386.rpm'
	'http://archives.fedoraproject.org/pub/archive/fedora/linux/releases/9/Fedora/i386/os/Packages/cracklib-2.8.12-2.i386.rpm'
	yp.conf)
provides=('linux')

md5sums=('2f5bcb4d4bf0174eca9a28e54c68c6b7'
         '752decc596451bb497ac230a0c717254'
         'e8ac03f6173ec0cc96d1128382797013'
         '22d77500dd07fb5244459f2ea44ab784'
         '4f60e017a2ddf52ac91c35290035d8c6'
         'cde899e2b3917105721a843bff116a64'
         'c5764f2d47973cae62cddda2f6775f29'
         '9dcadf84c88c9b9b2891ff82acff5e01'
         '81bdf495d7cbbf48e95a659519994577'
         '8b4d5c0f6fe65226d2820903b4d45353'
         '2fdca0eb3c63f0755a090a50c654f0f8'
         '22967cde51d9aa99a9656ae78bd85273'
         '2127b8bc8d304bb18611816c015950ea'
         '2c368b17879a7416f65ffadc4d8ca2a8'
         '28ee0b9bb4b00a25dc9ef237f2d7b689'
         '1032bee2406b57bc654ced8e06e8a6a9'
         '4c127df0945038f7b20557f1fb06476a'
         '21b2c644e7a210e05b5252dbe6b8e024'
         'a884f0d6a782573ed5730537107479df'
         '16a5f41e796b603e99c4005861d2f52c'
         'e2e07000f16e93dc3974ec29ea0de42b'
         '5664102abe8948dfc3d72bf1313dcc51'
         'ccd8ef16e85fa2486bb9f97834a43aee'
         '6c2b586b355b0f5b43b9f95f82c7f615'
         '22097efeb5d22415db3f23463c5eef41'
         'bb2310de5398e23fa3ac5c90747467b4'
         'd06b2314bbc58363cbe77a6a07589258'
         '7e38a0dbd106e1dcb242f2372aa73d4d'
         '691575a5ecdf41846abae07abfd01a2b'
         '0fdd6b9f57b02aae8d141d1d66c8c28c'
         '69b84b9eedca1d303583c797f09ec20e'
         '9a5913c1b446be699511f2652d43baff'
         '55074a4dea128ad825b39f9fe7883b70'
         'b55d3e8ee39fd78923ee1c60b6aab0a4'
         'e5eaae84df43c22128c2a62d74ce492f'
         '71e1ff45a8531134f1770e3dd9c9844f'
         '3085dba69b4efa9bf7f9396b86c83f7d'
         '2a975fa34df054f3970cae4631066546'
         'f829ff5c2c15851601363adbaca50a20'
         '06d63c9eb4364e035a6784159bca93b1'
         '42af2f41087c7bbf774bc7a1afd8857a'
         '43a85775e045e9ed74973259a100c8c2'
         'be1288a40a134b175696f80a6f4fcbbe'
         '2d1e77f0aacc185a6465375d17a2a802'
         'b1138fc49fddc4d6223e6b9748d93339'
         '72e8b4b4e2dc5fae472fb09f49b26f5f'
         '5b68e328eb558c1c558c5723ece45bdd'
         '794378866aad7e90d877469f3281d5af') 

prepare() {
  cd ${srcdir}
  for i in $(ls *rpm); do
    echo $i
   rpmextract.sh $i
  done
}

build() {

    #Remove the package files from src
    rm -f "${srcdir}"/*.{rpm,gz}

    #Remove uneeded directories
    for d in boot dev etc/fonts home \
             initrd media root tmp \
             var/log var/run var/tmp \
             usr/local usr/tmp
    do
        rm -rf "${srcdir}/${d}"
    done

    #Remove uneeded files
    for f in bin/df bin/su etc/exports \
             etc/group etc/localtime \
             etc/motd etc/passwd \
             etc/printcap etc/services \
             etc/protocols
    do
        rm -f "${srcdir}/${f}"
    done

    #Add some directories
    for a in usr/X11R6/share usr/X11R6/man \
             usr/X11R6/lib/tls \
             usr/X11R6/include usr/X11R6/bin
    do
        mkdir -p "${srcdir}/${a}"
    done

    # Create a good ld.so.conf and touch ld.so.cache
    echo -e '/lib\n/usr/lib\n/usr/X11R6/lib' >> "${srcdir}"/etc/ld.so.conf
    touch "${srcdir}"/etc/ld.so.cache

    install -m644 "${srcdir}"/yp.conf "${srcdir}"/etc
    touch "${srcdir}"/etc/mtab
    rm -f "${srcdir}"/yp.conf

#    chmod u+w ${srcdir}/usr/bin/*db4*

    msg "Branding ELF files, this may take a moment..."
    # Brand elfs...
    find ${srcdir}/bin ${srcdir}/sbin/ ${srcdir}/usr/bin \
         ${srcdir}/usr/sbin \
         -type f -print0 | xargs -0 file \
        | grep ELF | cut -d : -f 1 \
        | xargs brandelf -t Linux
    brandelf -t linux ${srcdir}/lib/ld-2.9.so
}

package() {
    cd ${srcdir}

    find * -type d -exec mkdir -p "${pkgdir}/compat/linux/{}" \;
    find * ! -type d | cpio -pm -R root:wheel ${pkgdir}/compat/linux

#    install -dm755 "${pkgdir}"/compat/linux
#    cp -Ra "${srcdir}"/* "${pkgdir}"/compat/linux

}
